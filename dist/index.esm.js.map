{"version":3,"file":"index.esm.js","sources":["../src/should-update.ts","../src/Headroom.tsx"],"sourcesContent":["export const shouldUpdate = (\n  lastKnownScrollY: number = 0,\n  currentScrollY: number = 0,\n  props: {\n    pin?: boolean;\n    pinStart: number;\n    upTolerance: number;\n    downTolerance: number;\n  },\n  state: {\n    state: any;\n    height?: number;\n  },\n) => {\n  const scrollDirection = currentScrollY >= lastKnownScrollY ? \"down\" : \"up\";\n  const distanceScrolled = Math.abs(currentScrollY - lastKnownScrollY);\n\n  if (props.pin) {\n    return {\n      action: state.state !== \"pinned\" ? \"pin\" : \"none\",\n      scrollDirection,\n      distanceScrolled,\n    };\n    // We're at the top and not fixed yet.\n  } else if (currentScrollY <= props.pinStart && state.state !== \"unfixed\") {\n    return {\n      action: \"unfix\",\n      scrollDirection,\n      distanceScrolled,\n    };\n    // We're unfixed and headed down. Carry on.\n  } else if (\n    typeof state.height === \"number\" &&\n    currentScrollY <= state.height &&\n    scrollDirection === \"down\" &&\n    state.state === \"unfixed\"\n  ) {\n    return {\n      action: \"none\",\n      scrollDirection,\n      distanceScrolled,\n    };\n  } else if (\n    typeof state.height === \"number\" &&\n    currentScrollY > state.height + props.pinStart &&\n    scrollDirection === \"down\" &&\n    state.state === \"unfixed\"\n  ) {\n    return {\n      action: \"unpin-snap\",\n      scrollDirection,\n      distanceScrolled,\n    };\n    // We're past the header and scrolling down.\n    // We transition to \"unpinned\" if necessary.\n  } else if (\n    scrollDirection === \"down\" &&\n    [\"pinned\", \"unfixed\"].indexOf(state.state) >= 0 &&\n    typeof state.height === \"number\" &&\n    currentScrollY > state.height + props.pinStart &&\n    distanceScrolled > props.downTolerance\n  ) {\n    return {\n      action: \"unpin\",\n      scrollDirection,\n      distanceScrolled,\n    };\n    // We're scrolling up, we transition to \"pinned\"\n  } else if (\n    scrollDirection === \"up\" &&\n    distanceScrolled > props.upTolerance &&\n    [\"pinned\", \"unfixed\"].indexOf(state.state) < 0\n  ) {\n    return {\n      action: \"pin\",\n      scrollDirection,\n      distanceScrolled,\n    };\n    // We're scrolling up, and inside the header.\n    // We transition to pin regardless of upTolerance\n  } else if (\n    scrollDirection === \"up\" &&\n    typeof state.height === \"number\" &&\n    currentScrollY <= state.height &&\n    [\"pinned\", \"unfixed\"].indexOf(state.state) < 0\n  ) {\n    return {\n      action: \"pin\",\n      scrollDirection,\n      distanceScrolled,\n    };\n  } else {\n    return {\n      action: \"none\",\n      scrollDirection,\n      distanceScrolled,\n    };\n  }\n};","\n\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\n\nimport { shouldUpdate } from \"./should-update\";\n\ntype HeadroomProps = {\n  children: React.ReactNode;\n  pin?: boolean;\n  upTolerance?: number;\n  downTolerance?: number;\n  pinStart?: number;\n  style?: React.CSSProperties;\n  onPin?: () => void;\n  onUnpin?: () => void;\n  onUnfix?: () => void;\n};\n\nexport const Headroom = (headroomProps: HeadroomProps) => {\n  const props = useMemo(\n    () => ({\n      ...headroomProps,\n      pin: false,\n      upTolerance: 5,\n      downTolerance: 0,\n      pinStart: 0,\n    }),\n    [headroomProps],\n  );\n\n  const currentScrollY = useRef(0);\n  const lastKnownScrollY = useRef(0);\n  const scrollTicking = useRef(false);\n  const resizeTicking = useRef(false);\n  const inner = useRef<HTMLDivElement>(null);\n\n  const [state, setState] = useState<{\n    state: string;\n    translateY: number | string;\n    height?: number;\n    animation: boolean;\n  }>({\n    state: \"unfixed\",\n    translateY: 0,\n    animation: false,\n  });\n\n  const setHeightOffset = () => {\n    setState((prev) => ({\n      ...prev,\n      height: inner.current ? inner.current.offsetHeight : 0,\n    }));\n\n    resizeTicking.current = false;\n  };\n\n  useEffect(() => {\n    setHeightOffset();\n  }, []);\n\n  const getScrollY = () => {\n    if (window.scrollY !== undefined) {\n      return window.scrollY;\n    } else {\n      return (document.documentElement || document.body.parentNode || document.body).scrollTop;\n    }\n  };\n\n  const getViewportHeight = useCallback(\n    () => window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight,\n    [],\n  );\n\n  const getDocumentHeight = useCallback(() => {\n    const body = document.body;\n    const documentElement = document.documentElement;\n\n    return Math.max(\n      body.scrollHeight,\n      documentElement.scrollHeight,\n      body.offsetHeight,\n      documentElement.offsetHeight,\n      body.clientHeight,\n      documentElement.clientHeight,\n    );\n  }, []);\n\n  const isOutOfBound = useCallback(\n    (currentScrollY: number) => {\n      const pastTop = currentScrollY < 0;\n\n      const scrollerPhysicalHeight = getViewportHeight();\n      const scrollerHeight = getDocumentHeight();\n\n      const pastBottom = currentScrollY + scrollerPhysicalHeight > scrollerHeight;\n\n      return pastTop || pastBottom;\n    },\n    [getDocumentHeight, getViewportHeight],\n  );\n\n  const pin = () => {\n    props.onPin?.();\n\n    setState((prev) => ({\n      ...prev,\n      translateY: 0,\n      animation: true,\n      state: \"pinned\",\n    }));\n  };\n\n  const unpin = useCallback(() => {\n    props.onUnpin?.();\n\n    setState((prev) => ({\n      ...prev,\n      translateY: \"-100%\",\n      animation: true,\n      state: \"unpinned\",\n    }));\n  }, [props]);\n\n  const unpinSnap = () => {\n    setState((prev) => ({\n      ...prev,\n      translateY: \"-100%\",\n      animation: false,\n      state: \"unpinned\",\n    }));\n  };\n\n  const unfix = useCallback(() => {\n    props.onUnfix?.();\n    setState((prev) => ({\n      ...prev,\n      translateY: 0,\n      animation: false,\n    }));\n\n    setTimeout(() => {\n      setState((prev) => ({ ...prev, state: \"unfixed\" }));\n    }, 0);\n  }, [props]);\n\n  const update = useCallback(() => {\n    currentScrollY.current = getScrollY();\n\n    if (!isOutOfBound(currentScrollY.current)) {\n      const { action } = shouldUpdate(\n        lastKnownScrollY.current,\n        currentScrollY.current,\n        props,\n        state,\n      );\n\n      if (action === \"pin\") {\n        pin();\n      } else if (action === \"unpin\") {\n        unpin();\n      } else if (action === \"unpin-snap\") {\n        unpinSnap();\n      } else if (action === \"unfix\") {\n        unfix();\n      }\n    }\n\n    lastKnownScrollY.current = currentScrollY.current;\n    scrollTicking.current = false;\n  }, [isOutOfBound, props, state, unfix, unpin]);\n\n  const handleScroll = useCallback(() => {\n    if (!scrollTicking.current) {\n      scrollTicking.current = true;\n      update();\n    }\n  }, [update]);\n\n  const handleResize = useCallback(() => {\n    if (!resizeTicking.current) {\n      resizeTicking.current = true;\n      setHeightOffset();\n    }\n  }, []);\n\n  useEffect(() => {\n    window.addEventListener(\"scroll\", handleScroll);\n    window.addEventListener(\"resize\", handleResize);\n\n    return () => {\n      window.removeEventListener(\"scroll\", handleScroll);\n      window.removeEventListener(\"resize\", handleResize);\n    };\n  }, [handleScroll, handleResize]);\n\n  let innerStyle: Record<string, string | number | undefined> = {\n    position: (state.state === \"unfixed\" ? \"relative\" : \"fixed\"),\n    top: 0,\n    left: 0,\n    right: 0,\n    zIndex: 1,\n    WebkitTransform: `translate3D(0, ${state.translateY}, 0)`,\n    MsTransform: `translate3D(0, ${state.translateY}, 0)`,\n    transform: `translate3D(0, ${state.translateY}, 0)`,\n  };\n\n  if (state.animation) {\n    innerStyle = {\n      ...innerStyle,\n      WebkitTransition: \"all .2s ease-in-out\",\n      MozTransition: \"all .2s ease-in-out\",\n      OTransition: \"all .2s ease-in-out\",\n      transition: \"all .2s ease-in-out\",\n    };\n  }\n\n  return (\n    <div\n      style={{\n        ...props.style,\n        height: state.height,\n      }}\n    >\n      <div ref={inner} style={innerStyle}>\n        {props.children}\n      </div>\n    </div>\n  );\n};\n\n"],"names":["Headroom","headroomProps","props","useMemo","Object","assign","pin","upTolerance","downTolerance","pinStart","currentScrollY","useRef","lastKnownScrollY","scrollTicking","resizeTicking","inner","state","setState","useState","translateY","animation","setHeightOffset","prev","height","current","offsetHeight","useEffect","getViewportHeight","useCallback","window","innerHeight","document","documentElement","clientHeight","body","getDocumentHeight","Math","max","scrollHeight","isOutOfBound","pastTop","scrollerPhysicalHeight","scrollerHeight","unpin","_a","onUnpin","call","unfix","onUnfix","setTimeout","update","undefined","scrollY","parentNode","scrollTop","action","scrollDirection","distanceScrolled","abs","indexOf","shouldUpdate","onPin","handleScroll","handleResize","addEventListener","removeEventListener","innerStyle","position","top","left","right","zIndex","WebkitTransform","MsTransform","transform","WebkitTransition","MozTransition","OTransition","transition","React","createElement","style","ref","children"],"mappings":"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"}